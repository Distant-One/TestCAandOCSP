# File:
#	./mk-ca-directories.yml
# Functionality:
#	- Used to create directory structure and initial files for a each caname in the list
#	- Will loop through canames listed in ca-info.yml creating directory trees for each
#
# usage:
#	 ansible-playbook -i hosts mk-ca-directories.yml 
# dependancies:
#	./vars/ca-info.yml
#	./cars/ca-secrets.yml
# Make the following directories and files:
#  <toplevelpath>/<ca_name>CA/<ca_name>CA/
#  <toplevelpath>/<ca_name>CA/newcerts/
#
# Below have not been implemented
#  <toplevelpath>/<ca_name>CA/<ca_name>CA.cnf
#  <toplevelpath>/<ca_name>CA/<ca_name>CA.key
#  <toplevelpath>/<ca_name>CA/<ca_name>CACsr.pem
#  <toplevelpath>/<ca_name>CA/<ca_name>CACert.pem
#  <toplevelpath>/<ca_name>CA/index.txt  #touch to create file
#  <toplevelpath>/<ca_name>CA/index.txt.attr  #touch to create file
#  <toplevelpath>/<ca_name>CA/serial       #echo 1000 > serial to create the file



- hosts: all
  
  tasks:

    - include_vars: ./vars/ca-info.yml
    - include_vars: ./vars/ca-secrets.yml

    - name: "Ping server."
      action: ping

    - name: "Create CA Directories"
      file:
        path: "{{ ca_top_dir }}/{{ item.caname }}"
        state: directory
      file:
        path: "{{ ca_top_dir }}/{{ item.caname }}/newcerts"
        state: directory
      with_items: "{{canames}}"

